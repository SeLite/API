<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: SeLite/misc/src/chrome/content/extensions/misc-core-extension.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: SeLite/misc/src/chrome/content/extensions/misc-core-extension.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*  Copyright 2011, 2012, 2013, 2014, 2016 Peter Kehl
    This file is part of SeLite Misc.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/>.
*/
"use strict";

Components.utils.import( "chrome://selite-misc/content/SeLiteMisc.js" );

// Following assignments is purely for JSDoc.
/** @class */
Selenium= Selenium;

/** @namespace */
SeLiteMisc= SeLiteMisc;

var loadedTimes= SeLiteExtensionSequencer.coreExtensionsLoadedTimes['SeLiteMisc'] || 0;
if( loadedTimes===1 ) {
// Anonymous function to prevent leaking into Selenium global namespace
( function() {
    var console= Components.utils.import("resource://gre/modules/Console.jsm", {}).console;

    //SeLiteExtensionSequencer.coreExtensionsLoadedTimes
    
    /* Not used. The only place that would use it for now is SeLite Misc ovOptions.js. However, it would need this function to match parameters that don't have part '=value', too.
     *     This is here, rather than in selite-misc.js component, because it needs to access global variable 'selenium'.
     *  I've tried to have it in selite-misc.js and to load the component using
     *  Components.utils.import( "chrome://selite-misc/content/SeLiteMisc.js", {selenium: selenium} );
     *  above, but that failed, because variable selenium is not yet defined when this file itself is processed.
     *  @TODO Document that in http://selite.github.io/JavascriptComplex
     */
     /**  This returns value of given parameter (if present) from current URL;
     *  if parameter name is not given, then it returns value of the last parameter in the URL.
     *  @param {string} paramName optional
     *  @return {string} value of the parameter (unescaped of URL encoding); undefined if there are no parameters at all, or if the requested parameter is not present.
     
    SeLiteMisc.getUrlParam= function getUrlParam( paramName ) {
        SeLiteMisc.ensureType( paramName, 'string', 'paramName' );
        var search= selenium.browserbot.getCurrentWindow().location.search; // If the URL has no parameters, then this is an empty string
        if( search!=='' ) {
            search= search.substr( 1 ); // removing leading '?'
        }
        var pairs= search.split( '&amp;' );
        var paramNameEquals= paramName+'=';
        for( var i=0; i&lt;pairs.length; i++ ) {
            var pair= pairs[i];
            if( pair.indexOf(paramNameEquals)===0 ) {
                return unescape( pair.substr(paramNameEquals.length) );
            }
        }
        return undefined;
    };/**/

        var loginManagerInstance = Components.classes["@mozilla.org/login-manager;1"].
            getService(Components.interfaces.nsILoginManager);

    var extractHostname= function extractHostname( hostnameOrUseBaseURL ) {
        var testLocation= selenium.browserbot.getCurrentWindow().location;
        SeLiteMisc.ensureType( hostnameOrUseBaseURL, ['undefined', 'string', 'boolean'], 'hostnameOrUseBaseURL' );
        return hostnameOrUseBaseURL
            ? (typeof hostnameOrUseBaseURL==='string'
                ? hostnameOrUseBaseURL
                : selenium.browserbot.baseUrl
              )
            : testLocation.protocol+ '//' +testLocation.hostname+
                (testLocation.port
                ? ':' +testLocation.port
                : '');
    };

    /** This retrieves a web form password for a user. It doesn't work with .htaccess/HTTP authentication,
        but that can be retrieved too, see
        &lt;br> https://developer.mozilla.org/En/Using_nsILoginManager
        &lt;br> https://developer.mozilla.org/en/XPCOM_Interface_Reference/nsILoginManager
        &lt;br> https://developer.mozilla.org/en/XPCOM_Interface_Reference/nsILoginInfo

        @param {string} username Case-sensitive username.
        @param {mixed} hostnameOrUseBaseURL String hostname in form 'https://server-name.some.domain'. It must contain http or https. It can contain the port (if not standard),
        but no trailing slash / neither any URI (path). Optional; if not present, then this uses the current website.
        If it's true (boolean), then the function uses Selenium IDE's "Base URL" field - which may be different to the test website (e.g. single-sign-on). @TODO Once/if https://github.com/SeleniumHQ/selenium/issues/1550 is fixed, I'd need to extract the protocol+host+port from Base URL here.
        @param {boolean} [returnLoginInfo] Whether to return nsILoginInfo object (if any); otherwise (and by default) this returns a string password (if any).
        @return {string} password if found; undefined otherwise
    */
    SeLiteMisc.loginManagerPassword= function loginManagerPassword( username, hostnameOrUseBaseURL, returnLoginInfo ) {
        SeLiteMisc.ensureType( username, 'string', 'username' );
        SeLiteMisc.ensureType( hostnameOrUseBaseURL, ['string', 'boolean', 'undefined'], 'hostnameOrUseBaseURL' );
        SeLiteMisc.ensureType( returnLoginInfo, ['boolean', 'undefined'], 'returnLoginInfo' );
        // You could also use passwordManager.getAllLogins(); it returns an array of nsILoginInfo objects
        var hostname= extractHostname( hostnameOrUseBaseURL );
        console.log( 'SeLiteMisc.loginManagerPassword(): hostname is ' +hostname );
        var logins = loginManagerInstance.findLogins(
            {}, hostname,
            '', // null doesn't work here. See https://developer.mozilla.org/En/Using_nsILoginManager: it says to use blank for web form auth.
            null
        );

        for( var i=0; i&lt;logins.length; i++ ) {
            if( logins[i].username==username ) {
                return returnLoginInfo
                    ? logins[i]
                    : logins[i].password;
            }
        }
    };

    /** It inserts or updates details in Firefox Login Manager.
     * */
    SeLiteMisc.setLoginManagerEntry= function setLoginManagerEntry( username, password, hostnameOrUseBaseURL, formActionOrUserBaseURL ) {
        SeLiteMisc.ensureType( username, 'string', 'username' );
        SeLiteMisc.ensureType( password, 'string', 'password' );
        SeLiteMisc.ensureType( hostnameOrUseBaseURL, ['string', 'boolean', 'undefined'], 'hostnameOrUseBaseURL' );
        SeLiteMisc.ensureType( formActionOrUserBaseURL, ['string', 'boolean', 'undefined'], 'formActionOrUserBaseURL' );
        var loginInfo= Components.classes["@mozilla.org/login-manager/loginInfo;1"]
                    .createInstance(Components.interfaces.nsILoginInfo);
        loginInfo.hostname= extractHostname( hostnameOrUseBaseURL );
        loginInfo.formSubmitURL= extractHostname( formActionOrUserBaseURL );
        loginInfo.httpRealm= null;
        loginInfo.username= username;
        loginInfo.password= password;
        loginInfo.usernameField= SeLiteSettings.commonSettings.fields['usernameField'].getDownToFolder().entry;
        loginInfo.passwordField= SeLiteSettings.commonSettings.fields['passwordField'].getDownToFolder().entry;
        var existingInfo= SeLiteMisc.loginManagerPassword( username, hostnameOrUseBaseURL, true );
        if( existingInfo===undefined ) {
            loginManagerInstance.addLogin( loginInfo );
        }
        else {
            loginManagerInstance.modifyLogin( existingInfo, loginInfo );
        }
    };

    var subScriptLoader = Components.classes["@mozilla.org/moz/jssubscript-loader;1"].getService(Components.interfaces.mozIJSSubScriptLoader);
    
    var originalSelenium= Selenium;
    Selenium= function SeleniumSeLiteMisc(browserbot) {
        originalSelenium.call( this, browserbot );
        SeLiteMisc.selenium= this;
    };
    // Following selite.github.io/JavascriptComplex#class-inheritance:
    Selenium.prototype= Object.create( originalSelenium.prototype );
    Selenium.prototype.constructor= Selenium;
    Selenium.prototype.originalConstructor= originalSelenium;
    for( var functionName in originalSelenium ) {
        Selenium[functionName]= originalSelenium[functionName];
    }
    
    Selenium.prototype.doRunJavascript= function doRunJavascript( fileURL, scope ) {
        fileURL+= fileURL.indexOf('?')&lt;0
            ? '?'
            : '&amp;';
        fileURL+= Date.now();
        try {
            if( scope ) {
                subScriptLoader.loadSubScript( fileURL, scope );
            }
            else {
                subScriptLoader.loadSubScript( fileURL );
            }
        }
        catch( e ) {
            throw SeLiteMisc.addStackToMessage( e, true );
            // doRunJavascript@chrome://selite-misc/content/extensions/core-extension.js
        }
    };
}) ();
}
SeLiteExtensionSequencer.coreExtensionsLoadedTimes['SeLiteMisc']= loadedTimes+1;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Abstract.html">Abstract</a></li><li><a href="CellInfo.html">CellInfo</a></li><li><a href="Column.html">Column</a></li><li><a href="Constructor.html">Constructor</a></li><li><a href="Create.html">Create</a></li><li><a href="FilledIn.html">FilledIn</a></li><li><a href="global.TestCaseDebugContext.html">TestCaseDebugContext</a></li><li><a href="RowInfo.html">RowInfo</a></li><li><a href="RowLevel.html">RowLevel</a></li><li><a href="RowLevelOrColumn.html">RowLevelOrColumn</a></li><li><a href="selblocks.Logger.html">Logger</a></li><li><a href="Selenium.html">Selenium</a></li><li><a href="SeLiteData.Db.html">Db</a></li><li><a href="SeLiteData.Table.html">Table</a></li><li><a href="SeLiteMisc.Enum.html">Enum</a></li><li><a href="SeLiteSettings.FieldInformation.html">FieldInformation</a></li><li><a href="SeLiteSettings.TestDbKeeper.html">TestDbKeeper</a></li><li><a href="SeLiteSettings.TestDbKeeper.Columns.html">Columns</a></li><li><a href="ValueSource.html">ValueSource</a></li></ul><h3>Namespaces</h3><ul><li><a href="global.html#global">global</a></li><li><a href="selblocks.html">selblocks</a></li><li><a href="selblocks.fn.html">fn</a></li><li><a href="selblocks.InfixExpressionParser.html">InfixExpressionParser</a></li><li><a href="selblocks.xp.html">xp</a></li><li><a href="SeLiteAutoCheck.html">SeLiteAutoCheck</a></li><li><a href="SeLiteData.html">SeLiteData</a></li><li><a href="SeLiteMisc.html">SeLiteMisc</a></li><li><a href="SeLiteSettings.html">SeLiteSettings</a></li></ul><h3>Global</h3><ul><li><a href="global.html#'static'">'static'</a></li><li><a href="global.html#allowMultivaluedNonChoices">allowMultivaluedNonChoices</a></li><li><a href="global.html#applicableColumns">applicableColumns</a></li><li><a href="global.html#array">array</a></li><li><a href="global.html#Array">Array</a></li><li><a href="global.html#bool">bool</a></li><li><a href="global.html#cachedManifests">cachedManifests</a></li><li><a href="global.html#cacheRatio">cacheRatio</a></li><li><a href="global.html#callStack">callStack</a></li><li><a href="global.html#checkField">checkField</a></li><li><a href="global.html#chooseFileOrFolder">chooseFileOrFolder</a></li><li><a href="global.html#chooseJavascriptFile">chooseJavascriptFile</a></li><li><a href="global.html#createTreeChildren">createTreeChildren</a></li><li><a href="global.html#directChildList">directChildList</a></li><li><a href="global.html#directRequisiteIncompatible">directRequisiteIncompatible</a></li><li><a href="global.html#Dotclear">Dotclear</a></li><li><a href="global.html#Drupal">Drupal</a></li><li><a href="global.html#ensureFieldName">ensureFieldName</a></li><li><a href="global.html#expandStoredVars">expandStoredVars</a></li><li><a href="global.html#fieldTreeRow">fieldTreeRow</a></li><li><a href="global.html#format">format</a></li><li><a href="global.html#formatCommands">formatCommands</a></li><li><a href="global.html#FUDforum">FUDforum</a></li><li><a href="global.html#generateFields">generateFields</a></li><li><a href="global.html#generateSets">generateSets</a></li><li><a href="global.html#generateTreeColumns">generateTreeColumns</a></li><li><a href="global.html#global#infoURLtoDownloadURL">infoURLtoDownloadURL</a></li><li><a href="global.html#global#int">int</a></li><li><a href="global.html#global#loadXMLDoc">loadXMLDoc</a></li><li><a href="global.html#global#locateConnectionInfo">locateConnectionInfo</a></li><li><a href="global.html#global#Location">Location</a></li><li><a href="global.html#global#manifestsDownToFolder">manifestsDownToFolder</a></li><li><a href="global.html#global#modules">modules</a></li><li><a href="global.html#global#moduleSetFields">moduleSetFields</a></li><li><a href="global.html#global#name">name</a></li><li><a href="global.html#global#Namespace-like">Namespace-like</a></li><li><a href="global.html#global#newValueRow">newValueRow</a></li><li><a href="global.html#global#NTH_RECORD">NTH_RECORD</a></li><li><a href="global.html#global#Null">Null</a></li><li><a href="global.html#global#Object">Object</a></li><li><a href="global.html#global#Only">Only</a></li><li><a href="global.html#global#parse">parse</a></li><li><a href="global.html#global#parseCommandsAndHeader">parseCommandsAndHeader</a></li><li><a href="global.html#global#phpMyFAQ">phpMyFAQ</a></li><li><a href="global.html#global#PluginDetails">PluginDetails</a></li><li><a href="global.html#global#preProcessEdit">preProcessEdit</a></li><li><a href="global.html#global#propertiesPart">propertiesPart</a></li><li><a href="global.html#global#proxyVerifyFieldsObjectHandler">proxyVerifyFieldsObjectHandler</a></li><li><a href="global.html#global#readFile">readFile</a></li><li><a href="global.html#global#removeCommentsGetLines">removeCommentsGetLines</a></li><li><a href="global.html#global#requisiteDetailsSubset">requisiteDetailsSubset</a></li><li><a href="global.html#global#roles">roles</a></li><li><a href="global.html#global#SeLiteMiscClassForVerifiedScope">SeLiteMiscClassForVerifiedScope</a></li><li><a href="global.html#global#Serendipity">Serendipity</a></li><li><a href="global.html#global#Serving">Serving</a></li><li><a href="global.html#global#setCellText">setCellText</a></li><li><a href="global.html#global#showingPerFolder">showingPerFolder</a></li><li><a href="global.html#global#SQLiteConnectionInfo">SQLiteConnectionInfo</a></li><li><a href="global.html#global#Static">Static</a></li><li><a href="global.html#global#string">string</a></li><li><a href="global.html#global#treeCell">treeCell</a></li><li><a href="global.html#global#treeColumn">treeColumn</a></li><li><a href="global.html#global#treeColumnElements">treeColumnElements</a></li><li><a href="global.html#global#treeRowsOrChildren">treeRowsOrChildren</a></li><li><a href="global.html#global#unnamedTestSuiteFolderChangeHandlers">unnamedTestSuiteFolderChangeHandlers</a></li><li><a href="global.html#global#updateSpecial">updateSpecial</a></li><li><a href="global.html#global#valueCompound">valueCompound</a></li><li><a href="global.html#global#Whether">Whether</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jun 10 2016 10:48:03 GMT+1000 (AEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
